# cargo clippy is a superset of cargo check, so we don't check manually
.tcode-quality:
  extends: .recompile-branch
  stage: check
  image: registry.gitlab.com/veloren/veloren-docker-ci/cache/quality:${CACHE_IMAGE_TAG}
  script:
    - ln -s /dockercache/target target
    - cat ./.gitlab/scripts/code-quality.sh
    - source ./.gitlab/scripts/code-quality.sh

.tsecurity:
  extends: .recompile-branch
  stage: check
  image: registry.gitlab.com/veloren/veloren-docker-ci/cache/quality:${CACHE_IMAGE_TAG}
  allow_failure: true
  cache: {} # Disabling cache as it is not needed in order to reduce time
  script:
    - ln -s /dockercache/target target
    - cat ./.gitlab/scripts/security.sh
    - source ./.gitlab/scripts/security.sh

code-quality:
  extends:
    - .recompile-branch
    - .tcode-quality

code-quality-pcache:
  extends:
    - .release
    - .persist-cache
    - .tcode-quality
